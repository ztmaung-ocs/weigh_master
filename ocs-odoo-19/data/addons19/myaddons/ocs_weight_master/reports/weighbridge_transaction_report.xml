<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- Custom Paper Format A5 -->
    <record id="paperformat_a5" model="report.paperformat">
        <field name="name">A5</field>
        <field name="default" eval="False"/>
        <field name="format">A5</field>
        <field name="orientation">Portrait</field>
        <field name="margin_top">3</field>
        <field name="margin_bottom">3</field>
        <field name="margin_left">5</field>
        <field name="margin_right">5</field>
        <field name="header_line" eval="False"/>
        <field name="header_spacing">0</field>
        <field name="dpi">90</field>
    </record>

    <!-- Report Action -->
    <record id="action_report_weighbridge_transaction" model="ir.actions.report">
        <field name="name">Weighbridge Transaction</field>
        <field name="model">weighbridge.transaction</field>
        <field name="report_type">qweb-html</field>
        <field name="report_name">ocs_weight_master.weighbridge_transaction_report</field>
        <field name="report_file">ocs_weight_master.weighbridge_transaction_report</field>
        <field name="paperformat_id" ref="paperformat_a5"/>
        <field name="print_report_name">Weighbridge Transaction</field>
    </record>

    <!-- Report Template -->
    <template id="weighbridge_transaction_report">
        <t t-call="web.html_container">
            <style>
                @media print {
                    @page {
                        size: A5 portrait;
                        margin: 3mm;
                    }
                    body {
                        margin: 0;
                        padding: 0;
                    }
                    .upper-copy, .lower-copy {
                        page-break-inside: avoid;
                    }
                    .lower-copy {
                        page-break-before: avoid;
                    }
                }
                @media screen {
                    body {
                        margin: 0;
                        padding: 10px;
                        background: #f5f5f5;
                    }
                }
            </style>
            <script>
                window.addEventListener('load', function() {
                    setTimeout(function() {
                        // Open print dialog for POS printing
                        if (window.print) {
                            window.print();
                        }
                    }, 500);
                });
                
                // Prevent PDF download, force print dialog
                window.addEventListener('beforeprint', function() {
                    // Ensure print dialog opens
                });
            </script>
            <t t-foreach="docs" t-as="o">
                <div style="width: 100%; page-break-after: avoid;">
                        <!-- Upper Copy (Driver Copy) -->
                        <div class="upper-copy" style="border: 2px solid #000; padding: 6px; margin-bottom: 4px; height: 95mm; box-sizing: border-box; overflow: hidden; page-break-inside: avoid; page-break-after: avoid;">
                            <div style="text-align: center; margin-bottom: 6px;">
                                <h2 style="margin: 0; font-size: 14px; font-weight: bold;">WEIGHBRIDGE TRANSACTION</h2>
                                <h3 style="margin: 2px 0; font-size: 11px; color: #666;">DRIVER COPY</h3>
                            </div>
                            
                            <table style="width: 100%; border-collapse: collapse; margin-bottom: 5px; font-size: 9px;">
                                <tr>
                                    <td style="width: 50%; padding: 2px; border-bottom: 1px solid #ddd;">
                                        <strong>Voucher No:</strong> <span t-field="o.voucher_no"/>
                                    </td>
                                    <td style="width: 50%; padding: 2px; border-bottom: 1px solid #ddd;">
                                        <strong>Vehicle No:</strong> <span t-field="o.vehicle_no"/>
                                    </td>
                                </tr>
                                <tr>
                                    <td style="padding: 2px; border-bottom: 1px solid #ddd;">
                                        <strong>Type:</strong> <span t-field="o.type"/>
                                    </td>
                                    <td style="padding: 2px; border-bottom: 1px solid #ddd;">
                                        <strong>State:</strong> <span t-field="o.state"/>
                                    </td>
                                </tr>
                                <tr>
                                    <td colspan="2" style="padding: 2px; border-bottom: 1px solid #ddd;">
                                        <strong>Driver Name:</strong> <span t-field="o.driver_name"/>
                                    </td>
                                </tr>
                            </table>

                            <table style="width: 100%; border-collapse: collapse; margin-bottom: 5px; font-size: 9px;">
                                <tr>
                                    <td style="width: 50%; padding: 2px;">
                                        <strong>Entrance Weight:</strong> <span t-field="o.entrance_weight" t-options="{'widget': 'float', 'precision': 3}"/> kg
                                    </td>
                                    <td style="width: 50%; padding: 2px;">
                                        <strong>Entrance Date:</strong> <span t-field="o.entrance_date" t-options="{'widget': 'datetime'}"/>
                                    </td>
                                </tr>
                                <tr>
                                    <td style="padding: 2px;">
                                        <strong>Exit Weight:</strong> <span t-field="o.exit_weight" t-options="{'widget': 'float', 'precision': 3}"/> kg
                                    </td>
                                    <td style="padding: 2px;">
                                        <strong>Exit Date:</strong> <span t-field="o.exit_date" t-options="{'widget': 'datetime'}"/>
                                    </td>
                                </tr>
                                <tr>
                                    <td colspan="2" style="padding: 2px; background-color: #f0f0f0;">
                                        <strong>Different Weight:</strong> <span t-field="o.net_weight" t-options="{'widget': 'float', 'precision': 3}"/> kg
                                    </td>
                                </tr>
                            </table>

                            <table style="width: 100%; border-collapse: collapse; margin-bottom: 5px; font-size: 9px;">
                                <tr t-if="o.driver_name">
                                    <td style="padding: 2px; border-bottom: 1px solid #ddd;">
                                        <strong>Driver Name:</strong> <span t-field="o.driver_name"/>
                                    </td>
                                </tr>
                                <tr t-if="o.driver_nrc">
                                    <td style="padding: 2px; border-bottom: 1px solid #ddd;">
                                        <strong>NRC:</strong> <span t-field="o.driver_nrc"/>
                                    </td>
                                </tr>
                                <tr t-if="o.driver_phone">
                                    <td style="padding: 2px; border-bottom: 1px solid #ddd;">
                                        <strong>Phone:</strong> <span t-field="o.driver_phone"/>
                                    </td>
                                </tr>
                                <tr t-if="o.company_name">
                                    <td style="padding: 2px; border-bottom: 1px solid #ddd;">
                                        <strong>Company Name:</strong> <span t-field="o.company_name"/>
                                    </td>
                                </tr>
                                <tr t-if="o.deliver_to">
                                    <td style="padding: 2px; border-bottom: 1px solid #ddd;">
                                        <strong>Deliver To:</strong> <span t-field="o.deliver_to"/>
                                    </td>
                                </tr>
                            </table>

                            <div t-if="o.product_ids" style="margin-top: 5px; font-size: 9px;">
                                <strong>Products:</strong>
                                <div t-foreach="o.product_ids" t-as="product" style="padding-left: 12px; font-size: 8px;">
                                    <span t-field="product.name"/>
                                </div>
                            </div>

                            <div t-if="o.remark1" style="margin-top: 5px; font-size: 9px;">
                                <strong>Remark 1:</strong> <span t-field="o.remark1"/>
                            </div>
                            <div t-if="o.remark2" style="margin-top: 3px; font-size: 9px;">
                                <strong>Remark 2:</strong> <span t-field="o.remark2"/>
                            </div>

                            <div style="margin-top: 8px; text-align: center; border-top: 1px solid #000; padding-top: 5px; font-size: 8px;">
                                <div>Driver Signature: _________________________</div>
                                <div style="margin-top: 3px;">Date: _________________________</div>
                            </div>
                        </div>

                        <!-- Lower Copy (Receipt) -->
                        <div class="lower-copy" style="border: 2px solid #000; padding: 6px; height: 95mm; box-sizing: border-box; overflow: hidden; page-break-inside: avoid; page-break-before: avoid;">
                            <div style="text-align: center; margin-bottom: 6px;">
                                <h2 style="margin: 0; font-size: 14px; font-weight: bold;">WEIGHBRIDGE TRANSACTION</h2>
                                <h3 style="margin: 2px 0; font-size: 11px; color: #666;">RECEIPT</h3>
                            </div>
                            
                            <table style="width: 100%; border-collapse: collapse; margin-bottom: 5px; font-size: 9px;">
                                <tr>
                                    <td style="width: 50%; padding: 2px; border-bottom: 1px solid #ddd;">
                                        <strong>Voucher No:</strong> <span t-field="o.voucher_no"/>
                                    </td>
                                    <td style="width: 50%; padding: 2px; border-bottom: 1px solid #ddd;">
                                        <strong>Vehicle No:</strong> <span t-field="o.vehicle_no"/>
                                    </td>
                                </tr>
                                <tr>
                                    <td style="padding: 2px; border-bottom: 1px solid #ddd;">
                                        <strong>Type:</strong> <span t-field="o.type"/>
                                    </td>
                                    <td style="padding: 2px; border-bottom: 1px solid #ddd;">
                                        <strong>State:</strong> <span t-field="o.state"/>
                                    </td>
                                </tr>
                                <tr>
                                    <td colspan="2" style="padding: 2px; border-bottom: 1px solid #ddd;">
                                        <strong>Driver Name:</strong> <span t-field="o.driver_name"/>
                                    </td>
                                </tr>
                            </table>

                            <table style="width: 100%; border-collapse: collapse; margin-bottom: 5px; font-size: 9px;">
                                <tr>
                                    <td style="width: 50%; padding: 2px;">
                                        <strong>Entrance Weight:</strong> <span t-field="o.entrance_weight" t-options="{'widget': 'float', 'precision': 3}"/> kg
                                    </td>
                                    <td style="width: 50%; padding: 2px;">
                                        <strong>Entrance Date:</strong> <span t-field="o.entrance_date" t-options="{'widget': 'datetime'}"/>
                                    </td>
                                </tr>
                                <tr>
                                    <td style="padding: 2px;">
                                        <strong>Exit Weight:</strong> <span t-field="o.exit_weight" t-options="{'widget': 'float', 'precision': 3}"/> kg
                                    </td>
                                    <td style="padding: 2px;">
                                        <strong>Exit Date:</strong> <span t-field="o.exit_date" t-options="{'widget': 'datetime'}"/>
                                    </td>
                                </tr>
                                <tr>
                                    <td colspan="2" style="padding: 2px; background-color: #f0f0f0;">
                                        <strong>Different Weight:</strong> <span t-field="o.net_weight" t-options="{'widget': 'float', 'precision': 3}"/> kg
                                    </td>
                                </tr>
                            </table>

                            <table style="width: 100%; border-collapse: collapse; margin-bottom: 5px; font-size: 9px;">
                                <tr t-if="o.driver_name">
                                    <td style="padding: 2px; border-bottom: 1px solid #ddd;">
                                        <strong>Driver Name:</strong> <span t-field="o.driver_name"/>
                                    </td>
                                </tr>
                                <tr t-if="o.driver_nrc">
                                    <td style="padding: 2px; border-bottom: 1px solid #ddd;">
                                        <strong>NRC:</strong> <span t-field="o.driver_nrc"/>
                                    </td>
                                </tr>
                                <tr t-if="o.driver_phone">
                                    <td style="padding: 2px; border-bottom: 1px solid #ddd;">
                                        <strong>Phone:</strong> <span t-field="o.driver_phone"/>
                                    </td>
                                </tr>
                                <tr t-if="o.company_name">
                                    <td style="padding: 2px; border-bottom: 1px solid #ddd;">
                                        <strong>Company Name:</strong> <span t-field="o.company_name"/>
                                    </td>
                                </tr>
                                <tr t-if="o.deliver_to">
                                    <td style="padding: 2px; border-bottom: 1px solid #ddd;">
                                        <strong>Deliver To:</strong> <span t-field="o.deliver_to"/>
                                    </td>
                                </tr>
                            </table>

                            <div t-if="o.product_ids" style="margin-top: 5px; font-size: 9px;">
                                <strong>Products:</strong>
                                <div t-foreach="o.product_ids" t-as="product" style="padding-left: 12px; font-size: 8px;">
                                    <span t-field="product.name"/>
                                </div>
                            </div>

                            <div t-if="o.remark1" style="margin-top: 5px; font-size: 9px;">
                                <strong>Remark 1:</strong> <span t-field="o.remark1"/>
                            </div>
                            <div t-if="o.remark2" style="margin-top: 3px; font-size: 9px;">
                                <strong>Remark 2:</strong> <span t-field="o.remark2"/>
                            </div>

                            <div style="margin-top: 8px; text-align: center; border-top: 1px solid #000; padding-top: 5px; font-size: 8px;">
                                <div>Authorized Signature: _________________________</div>
                                <div style="margin-top: 3px;">Date: _________________________</div>
                            </div>
                        </div>
                </div>
            </t>
        </t>
    </template>
</odoo>

